!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n((e=e||self).Lemonade={})}(this,(function(e){"use strict";function n(){return(n=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e}).apply(this,arguments)}function t(e){return"/"===e.charAt(0)}function r(e,n){for(var t=n,r=t+1,i=e.length;r<i;t+=1,r+=1)e[t]=e[r];e.pop()}function i(e){var n=e||"/",t="",r="",i=n.indexOf("#");-1!==i&&(r=n.substr(i),n=n.substr(0,i));var o=n.indexOf("?");return-1!==o&&(t=n.substr(o),n=n.substr(0,o)),{pathname:n,search:"?"===t?"":t,hash:"#"===r?"":r}}function o(e,o,a,s){var f;"string"==typeof e?(f=i(e)).state=o:(void 0===(f=n({},e)).pathname&&(f.pathname=""),f.search?"?"!==f.search.charAt(0)&&(f.search="?"+f.search):f.search="",f.hash?"#"!==f.hash.charAt(0)&&(f.hash="#"+f.hash):f.hash="",void 0!==o&&void 0===f.state&&(f.state=o));try{f.pathname=decodeURI(f.pathname)}catch(e){throw e instanceof URIError?new URIError('Pathname "'+f.pathname+'" could not be decoded. This is likely caused by an invalid percent-encoding.'):e}return a&&(f.key=a),s?f.pathname?"/"!==f.pathname.charAt(0)&&(f.pathname=function(e,n){void 0===n&&(n="");var i,o=e&&e.split("/")||[],a=n&&n.split("/")||[],s=e&&t(e),f=n&&t(n),c=s||f;if(e&&t(e)?a=o:o.length&&(a.pop(),a=a.concat(o)),!a.length)return"/";if(a.length){var u=a[a.length-1];i="."===u||".."===u||""===u}else i=!1;for(var l=0,h=a.length;h>=0;h--){var d=a[h];"."===d?r(a,h):".."===d?(r(a,h),l++):l&&(r(a,h),l--)}if(!c)for(;l--;l)a.unshift("..");!c||""===a[0]||a[0]&&t(a[0])||a.unshift("");var p=a.join("/");return i&&"/"!==p.substr(-1)&&(p+="/"),p}(f.pathname,s.pathname)):f.pathname=s.pathname:f.pathname||(f.pathname="/"),f}var a=!("undefined"==typeof window||!window.document||!window.document.createElement);function s(e,n){n(window.confirm(e))}var f="popstate",c="hashchange";function u(){try{return window.history.state||{}}catch(e){return{}}}function l(e){void 0===e&&(e={}),a||function(e,n){if(!e)throw new Error("Invariant failed")}(!1);var t,r,i=window.history,l=(-1===(t=window.navigator.userAgent).indexOf("Android 2.")&&-1===t.indexOf("Android 4.0")||-1===t.indexOf("Mobile Safari")||-1!==t.indexOf("Chrome")||-1!==t.indexOf("Windows Phone"))&&window.history&&"pushState"in window.history,h=!(-1===window.navigator.userAgent.indexOf("Trident")),d=e,p=d.forceRefresh,v=void 0!==p&&p,w=d.getUserConfirmation,g=void 0===w?s:w,y=d.keyLength,m=void 0===y?6:y,x=e.basename?function(e){return"/"===e.charAt(e.length-1)?e.slice(0,-1):e}("/"===(r=e.basename).charAt(0)?r:"/"+r):"";function A(e){var n=e||{},t=n.key,r=n.state,i=window.location,a=i.pathname+i.search+i.hash;return x&&(a=function(e,n){return function(e,n){return 0===e.toLowerCase().indexOf(n.toLowerCase())&&-1!=="/?#".indexOf(e.charAt(n.length))}(e,n)?e.substr(n.length):e}(a,x)),o(a,r,t)}function E(){return Math.random().toString(36).substr(2,m)}var O,b,k=(O=null,b=[],{setPrompt:function(e){return O=e,function(){O===e&&(O=null)}},confirmTransitionTo:function(e,n,t,r){if(null!=O){var i="function"==typeof O?O(e,n):O;"string"==typeof i?"function"==typeof t?t(i,r):r(!0):r(!1!==i)}else r(!0)},appendListener:function(e){var n=!0;function t(){n&&e.apply(void 0,arguments)}return b.push(t),function(){n=!1,b=b.filter((function(e){return e!==t}))}},notifyListeners:function(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];b.forEach((function(e){return e.apply(void 0,n)}))}});function R(e){n(j,e),j.length=i.length,k.notifyListeners(j.location,j.action)}function P(e){(function(e){return void 0===e.state&&-1===navigator.userAgent.indexOf("CriOS")})(e)||L(A(e.state))}function T(){L(A(u()))}var C=!1;function L(e){if(C)C=!1,R();else{k.confirmTransitionTo(e,"POP",g,(function(n){n?R({action:"POP",location:e}):function(e){var n=j.location,t=M.indexOf(n.key);-1===t&&(t=0);var r=M.indexOf(e.key);-1===r&&(r=0);var i=t-r;i&&(C=!0,N(i))}(e)}))}}var I=A(u()),M=[I.key];function S(e){return x+function(e){var n=e.pathname,t=e.search,r=e.hash,i=n||"/";return t&&"?"!==t&&(i+="?"===t.charAt(0)?t:"?"+t),r&&"#"!==r&&(i+="#"===r.charAt(0)?r:"#"+r),i}(e)}function N(e){i.go(e)}var U=0;function D(e){1===(U+=e)&&1===e?(window.addEventListener(f,P),h&&window.addEventListener(c,T)):0===U&&(window.removeEventListener(f,P),h&&window.removeEventListener(c,T))}var H=!1;var j={length:i.length,action:"POP",location:I,createHref:S,push:function(e,n){var t="PUSH",r=o(e,n,E(),j.location);k.confirmTransitionTo(r,t,g,(function(e){if(e){var n=S(r),o=r.key,a=r.state;if(l)if(i.pushState({key:o,state:a},null,n),v)window.location.href=n;else{var s=M.indexOf(j.location.key),f=M.slice(0,s+1);f.push(r.key),M=f,R({action:t,location:r})}else window.location.href=n}}))},replace:function(e,n){var t="REPLACE",r=o(e,n,E(),j.location);k.confirmTransitionTo(r,t,g,(function(e){if(e){var n=S(r),o=r.key,a=r.state;if(l)if(i.replaceState({key:o,state:a},null,n),v)window.location.replace(n);else{var s=M.indexOf(j.location.key);-1!==s&&(M[s]=r.key),R({action:t,location:r})}else window.location.replace(n)}}))},go:N,goBack:function(){N(-1)},goForward:function(){N(1)},block:function(e){void 0===e&&(e=!1);var n=k.setPrompt(e);return H||(D(1),H=!0),function(){return H&&(H=!1,D(-1)),n()}},listen:function(e){var n=k.appendListener(e);return D(1),function(){D(-1),n()}}};return j}function h(e,n){void 0===n&&(n={});for(var t=function(e){for(var n=[],t=0;t<e.length;){var r=e[t];if("*"!==r&&"+"!==r&&"?"!==r)if("\\"!==r)if("{"!==r)if("}"!==r)if(":"!==r)if("("!==r)n.push({type:"CHAR",index:t,value:e[t++]});else{var i=1,o="";if("?"===e[s=t+1])throw new TypeError('Pattern cannot start with "?" at '+s);for(;s<e.length;)if("\\"!==e[s]){if(")"===e[s]){if(0==--i){s++;break}}else if("("===e[s]&&(i++,"?"!==e[s+1]))throw new TypeError("Capturing groups are not allowed at "+s);o+=e[s++]}else o+=e[s++]+e[s++];if(i)throw new TypeError("Unbalanced pattern at "+t);if(!o)throw new TypeError("Missing pattern at "+t);n.push({type:"PATTERN",index:t,value:o}),t=s}else{for(var a="",s=t+1;s<e.length;){var f=e.charCodeAt(s);if(!(f>=48&&f<=57||f>=65&&f<=90||f>=97&&f<=122||95===f))break;a+=e[s++]}if(!a)throw new TypeError("Missing parameter name at "+t);n.push({type:"NAME",index:t,value:a}),t=s}else n.push({type:"CLOSE",index:t,value:e[t++]});else n.push({type:"OPEN",index:t,value:e[t++]});else n.push({type:"ESCAPED_CHAR",index:t++,value:e[t++]});else n.push({type:"MODIFIER",index:t,value:e[t++]})}return n.push({type:"END",index:t,value:""}),n}(e),r=n.prefixes,i=void 0===r?"./":r,o="[^"+d(n.delimiter||"/#?")+"]+?",a=[],s=0,f=0,c="",u=function(e){if(f<t.length&&t[f].type===e)return t[f++].value},l=function(e){var n=u(e);if(void 0!==n)return n;var r=t[f],i=r.type,o=r.index;throw new TypeError("Unexpected "+i+" at "+o+", expected "+e)},h=function(){for(var e,n="";e=u("CHAR")||u("ESCAPED_CHAR");)n+=e;return n};f<t.length;){var p=u("CHAR"),v=u("NAME"),w=u("PATTERN");if(v||w){var g=p||"";-1===i.indexOf(g)&&(c+=g,g=""),c&&(a.push(c),c=""),a.push({name:v||s++,prefix:g,suffix:"",pattern:w||o,modifier:u("MODIFIER")||""})}else{var y=p||u("ESCAPED_CHAR");if(y)c+=y;else if(c&&(a.push(c),c=""),u("OPEN")){g=h();var m=u("NAME")||"",x=u("PATTERN")||"",A=h();l("CLOSE"),a.push({name:m||(x?s++:""),pattern:m&&!x?o:x,prefix:g,suffix:A,modifier:u("MODIFIER")||""})}else l("END")}}return a}function d(e){return e.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1")}function p(e){return e&&e.sensitive?"":"i"}function v(e,n,t){return function(e,n,t){void 0===t&&(t={});for(var r=t.strict,i=void 0!==r&&r,o=t.start,a=void 0===o||o,s=t.end,f=void 0===s||s,c=t.encode,u=void 0===c?function(e){return e}:c,l="["+d(t.endsWith||"")+"]|$",h="["+d(t.delimiter||"/#?")+"]",v=a?"^":"",w=0,g=e;w<g.length;w++){var y=g[w];if("string"==typeof y)v+=d(u(y));else{var m=d(u(y.prefix)),x=d(u(y.suffix));if(y.pattern)if(n&&n.push(y),m||x)if("+"===y.modifier||"*"===y.modifier){var A="*"===y.modifier?"?":"";v+="(?:"+m+"((?:"+y.pattern+")(?:"+x+m+"(?:"+y.pattern+"))*)"+x+")"+A}else v+="(?:"+m+"("+y.pattern+")"+x+")"+y.modifier;else v+="("+y.pattern+")"+y.modifier;else v+="(?:"+m+x+")"+y.modifier}}if(f)i||(v+=h+"?"),v+=t.endsWith?"(?="+l+")":"$";else{var E=e[e.length-1],O="string"==typeof E?h.indexOf(E[E.length-1])>-1:void 0===E;i||(v+="(?:"+h+"(?="+l+"))?"),O||(v+="(?="+h+"|"+l+")")}return new RegExp(v,p(t))}(h(e,t),n,t)}function w(e,n,t){return e instanceof RegExp?function(e,n){if(!n)return e;var t=e.source.match(/\((?!\?)/g);if(t)for(var r=0;r<t.length;r++)n.push({name:r,prefix:"",suffix:"",modifier:"",pattern:""});return e}(e,n):Array.isArray(e)?function(e,n,t){var r=e.map((function(e){return w(e,n,t).source}));return new RegExp("(?:"+r.join("|")+")",p(t))}(e,n,t):v(e,n,t)}function g(e){return function(e){return{path:e.replace(window.location.origin,"")}}(e).path}function y(e,n){return function(e,n){return new RegExp("^"+n+"(\\/|\\?|#|$)","i").test(e)}(e,n)?e.substr(n.length):e}function m(e){return"/"===e.charAt(e.length-1)?e.slice(0,-1):e}function x(e){if(e){const n=e.getAttribute&&e.getAttribute("xlink:href");if("string"==typeof n)return n;if(e.href)return e.href}return!1}e.Router=function({defaultTransition:e={play:function(e,n){e&&e.leave(n),n.enter(e)}},basename:n="",scrollRestoration:t="auto",transitionParams:r={}}={}){const o=[],a=[],s=new Map;let f=l({basename:n}),c=null,u=null;async function h(n,t){try{const i=m(n.pathname);let u;if(s.has(i))u=s.get(i);else for(let e=0;e<o.length;e++){const{urls:n,fn:t}=o[e];for(let e=0;e<n.length;e++){const r=[],o="*"===n[e]?/^\/.*(?:\/)?$/i:w(n[e],r),a=""!==i?o.exec(i):o.exec("/");if(a&&a.length>0){const[e,...o]=a,f=r.reduce(((e,n,t)=>(e[n.name]=o[t],e)),{}),c=[...n,i].filter((e=>!e.includes(":")));await t({urls:c,url:i,params:f}),s.has(i)&&(u=s.get(i));break}}if(u)break}if(u)if(d.nextLocation=f.createHref(n),a.length>0)for(let n=0;n<a.length;n++){const{fromURLs:o,toURLs:s,backAndForth:f,fn:l}=a[n],h=o.includes("*")||o.includes(t),d=f&&o.includes(i),p=s.includes("*")||s.includes(i),v=f&&s.includes(t);if(h&&p||d&&v){const e=await l();let n=c,t=u;c=u,await e.play(n,t,r)}else{let n=c,t=u;c=u,await e.play(n,t,r)}}else{let n=c,t=u;c=u,await e.play(n,t,r)}else console.error("Router :: View not found",s)}catch(e){console.error(e)}}window.history.scrollRestoration=t;const d={nextLocation:null,clickIgnoreClass:"no-router",match:function(e,n){Array.isArray(e)||(e=[e]),o.push({urls:e,fn:n})},transition:function(e,n,t,r=!0){e=Array.isArray(e)?e:[e],n=Array.isArray(n)?n:[n],a.push({fromURLs:e,toURLs:n,fn:t,backAndForth:r})},view:function(e,n){const t=n();Array.isArray(e)||(e=[e]);for(let n=0;n<e.length;n++){let r=m(e[n]);s.set(r,t)}},listen:function({clickEvents:e=!1,clickIgnoreClass:t="no-router"}={}){d.clickIgnoreClass=t,u=y(i(g(window.location.href)).pathname,n),f.listen((e=>{h(e,u),u=y(e.pathname,n)})),h(f.location,null),e&&document.addEventListener("click",(e=>{let n=e.target;for(;n&&!x(n);)n=n.parentNode;if(n&&function(e,n){const t=x(n),r=e.which>1||e.metaKey||e.ctrlKey||e.shiftKey||e.altKey,i=n.target&&"_blank"===n.target,o=window.location.protocol!==n.protocol||window.location.hostname!==n.hostname,a="string"===n.getAttribute("download"),s=t&&t.includes("mailto:");return!(r||i||o||a||s)}(e,n)&&!n.classList.contains(d.clickIgnoreClass)){e.preventDefault(),e.stopPropagation();const t=g(x(n));d.goTo(t)}}))},goTo:function(e){const{pathname:t,search:r,hash:o}=i(g(window.location.href)),a=g(e),{pathname:s,search:c,hash:u}=i(a);t===s&&r===c&&o===u||f.push(y(a,n))},history:f,getPath:e=>y(g(e),n)};return d},Object.defineProperty(e,"__esModule",{value:!0})}));
