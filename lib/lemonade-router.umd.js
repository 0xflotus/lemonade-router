!function(n,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((n=n||self).Lemonade={})}(this,(function(n){"use strict";function e(){return(e=Object.assign||function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n}).apply(this,arguments)}function t(n){return"/"===n.charAt(0)}function r(n,e){for(var t=e,r=t+1,i=n.length;r<i;t+=1,r+=1)n[t]=n[r];n.pop()}function i(n,i,o,a){var s;"string"==typeof n?(s=function(n){var e=n||"/",t="",r="",i=e.indexOf("#");-1!==i&&(r=e.substr(i),e=e.substr(0,i));var o=e.indexOf("?");return-1!==o&&(t=e.substr(o),e=e.substr(0,o)),{pathname:e,search:"?"===t?"":t,hash:"#"===r?"":r}}(n)).state=i:(void 0===(s=e({},n)).pathname&&(s.pathname=""),s.search?"?"!==s.search.charAt(0)&&(s.search="?"+s.search):s.search="",s.hash?"#"!==s.hash.charAt(0)&&(s.hash="#"+s.hash):s.hash="",void 0!==i&&void 0===s.state&&(s.state=i));try{s.pathname=decodeURI(s.pathname)}catch(n){throw n instanceof URIError?new URIError('Pathname "'+s.pathname+'" could not be decoded. This is likely caused by an invalid percent-encoding.'):n}return o&&(s.key=o),a?s.pathname?"/"!==s.pathname.charAt(0)&&(s.pathname=function(n,e){void 0===e&&(e="");var i,o=n&&n.split("/")||[],a=e&&e.split("/")||[],s=n&&t(n),f=e&&t(e),c=s||f;if(n&&t(n)?a=o:o.length&&(a.pop(),a=a.concat(o)),!a.length)return"/";if(a.length){var u=a[a.length-1];i="."===u||".."===u||""===u}else i=!1;for(var l=0,h=a.length;h>=0;h--){var d=a[h];"."===d?r(a,h):".."===d?(r(a,h),l++):l&&(r(a,h),l--)}if(!c)for(;l--;l)a.unshift("..");!c||""===a[0]||a[0]&&t(a[0])||a.unshift("");var p=a.join("/");return i&&"/"!==p.substr(-1)&&(p+="/"),p}(s.pathname,a.pathname)):s.pathname=a.pathname:s.pathname||(s.pathname="/"),s}var o=!("undefined"==typeof window||!window.document||!window.document.createElement);function a(n,e){e(window.confirm(n))}function s(){try{return window.history.state||{}}catch(n){return{}}}function f(n){void 0===n&&(n={}),o||function(n,e){if(!n)throw new Error("Invariant failed")}(!1);var t,r,f=window.history,c=(-1===(t=window.navigator.userAgent).indexOf("Android 2.")&&-1===t.indexOf("Android 4.0")||-1===t.indexOf("Mobile Safari")||-1!==t.indexOf("Chrome")||-1!==t.indexOf("Windows Phone"))&&window.history&&"pushState"in window.history,u=!(-1===window.navigator.userAgent.indexOf("Trident")),l=n,h=l.forceRefresh,d=void 0!==h&&h,p=l.getUserConfirmation,v=void 0===p?a:p,w=l.keyLength,g=void 0===w?6:w,y=n.basename?function(n){return"/"===n.charAt(n.length-1)?n.slice(0,-1):n}("/"===(r=n.basename).charAt(0)?r:"/"+r):"";function m(n){var e=n||{},t=e.key,r=e.state,o=window.location,a=o.pathname+o.search+o.hash;return y&&(a=function(n,e){return function(n,e){return 0===n.toLowerCase().indexOf(e.toLowerCase())&&-1!=="/?#".indexOf(n.charAt(e.length))}(n,e)?n.substr(e.length):n}(a,y)),i(a,r,t)}function A(){return Math.random().toString(36).substr(2,g)}var x,E,O=(x=null,E=[],{setPrompt:function(n){return x=n,function(){x===n&&(x=null)}},confirmTransitionTo:function(n,e,t,r){if(null!=x){var i="function"==typeof x?x(n,e):x;"string"==typeof i?"function"==typeof t?t(i,r):r(!0):r(!1!==i)}else r(!0)},appendListener:function(n){var e=!0;function t(){e&&n.apply(void 0,arguments)}return E.push(t),function(){e=!1,E=E.filter((function(n){return n!==t}))}},notifyListeners:function(){for(var n=arguments.length,e=new Array(n),t=0;t<n;t++)e[t]=arguments[t];E.forEach((function(n){return n.apply(void 0,e)}))}});function b(n){e(H,n),H.length=f.length,O.notifyListeners(H.location,H.action)}function k(n){(function(n){return void 0===n.state&&-1===navigator.userAgent.indexOf("CriOS")})(n)||T(m(n.state))}function R(){T(m(s()))}var P=!1;function T(n){if(P)P=!1,b();else{O.confirmTransitionTo(n,"POP",v,(function(e){e?b({action:"POP",location:n}):function(n){var e=H.location,t=L.indexOf(e.key);-1===t&&(t=0);var r=L.indexOf(n.key);-1===r&&(r=0);var i=t-r;i&&(P=!0,S(i))}(n)}))}}var C=m(s()),L=[C.key];function I(n){return y+function(n){var e=n.pathname,t=n.search,r=n.hash,i=e||"/";return t&&"?"!==t&&(i+="?"===t.charAt(0)?t:"?"+t),r&&"#"!==r&&(i+="#"===r.charAt(0)?r:"#"+r),i}(n)}function S(n){f.go(n)}var M=0;function U(n){1===(M+=n)&&1===n?(window.addEventListener("popstate",k),u&&window.addEventListener("hashchange",R)):0===M&&(window.removeEventListener("popstate",k),u&&window.removeEventListener("hashchange",R))}var N=!1;var H={length:f.length,action:"POP",location:C,createHref:I,push:function(n,e){var t=i(n,e,A(),H.location);O.confirmTransitionTo(t,"PUSH",v,(function(n){if(n){var e=I(t),r=t.key,i=t.state;if(c)if(f.pushState({key:r,state:i},null,e),d)window.location.href=e;else{var o=L.indexOf(H.location.key),a=L.slice(0,o+1);a.push(t.key),L=a,b({action:"PUSH",location:t})}else window.location.href=e}}))},replace:function(n,e){var t=i(n,e,A(),H.location);O.confirmTransitionTo(t,"REPLACE",v,(function(n){if(n){var e=I(t),r=t.key,i=t.state;if(c)if(f.replaceState({key:r,state:i},null,e),d)window.location.replace(e);else{var o=L.indexOf(H.location.key);-1!==o&&(L[o]=t.key),b({action:"REPLACE",location:t})}else window.location.replace(e)}}))},go:S,goBack:function(){S(-1)},goForward:function(){S(1)},block:function(n){void 0===n&&(n=!1);var e=O.setPrompt(n);return N||(U(1),N=!0),function(){return N&&(N=!1,U(-1)),e()}},listen:function(n){var e=O.appendListener(n);return U(1),function(){U(-1),e()}}};return H}function c(n,e){void 0===e&&(e={});for(var t=function(n){for(var e=[],t=0;t<n.length;){var r=n[t];if("*"!==r&&"+"!==r&&"?"!==r)if("\\"!==r)if("{"!==r)if("}"!==r)if(":"!==r)if("("!==r)e.push({type:"CHAR",index:t,value:n[t++]});else{var i=1,o="";if("?"===n[s=t+1])throw new TypeError('Pattern cannot start with "?" at '+s);for(;s<n.length;)if("\\"!==n[s]){if(")"===n[s]){if(0===--i){s++;break}}else if("("===n[s]&&(i++,"?"!==n[s+1]))throw new TypeError("Capturing groups are not allowed at "+s);o+=n[s++]}else o+=n[s++]+n[s++];if(i)throw new TypeError("Unbalanced pattern at "+t);if(!o)throw new TypeError("Missing pattern at "+t);e.push({type:"PATTERN",index:t,value:o}),t=s}else{for(var a="",s=t+1;s<n.length;){var f=n.charCodeAt(s);if(!(f>=48&&f<=57||f>=65&&f<=90||f>=97&&f<=122||95===f))break;a+=n[s++]}if(!a)throw new TypeError("Missing parameter name at "+t);e.push({type:"NAME",index:t,value:a}),t=s}else e.push({type:"CLOSE",index:t,value:n[t++]});else e.push({type:"OPEN",index:t,value:n[t++]});else e.push({type:"ESCAPED_CHAR",index:t++,value:n[t++]});else e.push({type:"MODIFIER",index:t,value:n[t++]})}return e.push({type:"END",index:t,value:""}),e}(n),r=e.prefixes,i=void 0===r?"./":r,o="[^"+u(e.delimiter||"/#?")+"]+?",a=[],s=0,f=0,c="",l=function(n){if(f<t.length&&t[f].type===n)return t[f++].value},h=function(n){var e=l(n);if(void 0!==e)return e;var r=t[f],i=r.type,o=r.index;throw new TypeError("Unexpected "+i+" at "+o+", expected "+n)},d=function(){for(var n,e="";n=l("CHAR")||l("ESCAPED_CHAR");)e+=n;return e};f<t.length;){var p=l("CHAR"),v=l("NAME"),w=l("PATTERN");if(v||w){var g=p||"";-1===i.indexOf(g)&&(c+=g,g=""),c&&(a.push(c),c=""),a.push({name:v||s++,prefix:g,suffix:"",pattern:w||o,modifier:l("MODIFIER")||""})}else{var y=p||l("ESCAPED_CHAR");if(y)c+=y;else if(c&&(a.push(c),c=""),l("OPEN")){g=d();var m=l("NAME")||"",A=l("PATTERN")||"",x=d();h("CLOSE"),a.push({name:m||(A?s++:""),pattern:m&&!A?o:A,prefix:g,suffix:x,modifier:l("MODIFIER")||""})}else h("END")}}return a}function u(n){return n.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1")}function l(n){return n&&n.sensitive?"":"i"}function h(n,e,t){return function(n,e,t){void 0===t&&(t={});for(var r=t.strict,i=void 0!==r&&r,o=t.start,a=void 0===o||o,s=t.end,f=void 0===s||s,c=t.encode,h=void 0===c?function(n){return n}:c,d="["+u(t.endsWith||"")+"]|$",p="["+u(t.delimiter||"/#?")+"]",v=a?"^":"",w=0,g=n;w<g.length;w++){var y=g[w];if("string"==typeof y)v+=u(h(y));else{var m=u(h(y.prefix)),A=u(h(y.suffix));if(y.pattern)if(e&&e.push(y),m||A)if("+"===y.modifier||"*"===y.modifier){var x="*"===y.modifier?"?":"";v+="(?:"+m+"((?:"+y.pattern+")(?:"+A+m+"(?:"+y.pattern+"))*)"+A+")"+x}else v+="(?:"+m+"("+y.pattern+")"+A+")"+y.modifier;else v+="("+y.pattern+")"+y.modifier;else v+="(?:"+m+A+")"+y.modifier}}if(f)i||(v+=p+"?"),v+=t.endsWith?"(?="+d+")":"$";else{var E=n[n.length-1],O="string"==typeof E?p.indexOf(E[E.length-1])>-1:void 0===E;i||(v+="(?:"+p+"(?="+d+"))?"),O||(v+="(?="+p+"|"+d+")")}return new RegExp(v,l(t))}(c(n,t),e,t)}function d(n,e,t){return n instanceof RegExp?function(n,e){if(!e)return n;var t=n.source.match(/\((?!\?)/g);if(t)for(var r=0;r<t.length;r++)e.push({name:r,prefix:"",suffix:"",modifier:"",pattern:""});return n}(n,e):Array.isArray(n)?function(n,e,t){var r=n.map((function(n){return d(n,e,t).source}));return new RegExp("(?:"+r.join("|")+")",l(t))}(n,e,t):h(n,e,t)}function p(n){return function(n){return{path:n.replace(window.location.origin,"")}}(n).path}function v(n,e){return function(n,e){return new RegExp("^"+e+"(\\/|\\?|#|$)","i").test(n)}(n,e)?n.substr(e.length):n}function w(n){return"/"===n.charAt(n.length-1)?n.slice(0,-1):n}function g(n){if(n){const e=n.getAttribute&&n.getAttribute("xlink:href");if("string"==typeof e)return e;if(n.href)return n.href}return!1}n.Router=function({defaultTransition:n={play:function(n,e){n&&n.leave(e),e.enter(n)}},basename:e="",scrollRestoration:t="auto",transitionParams:r={}}={}){const i=[],o=[],a=new Map;let s=f({basename:e}),c=null,u=null;async function l(e,t){try{const f=w(e.pathname);let u;if(a.has(f))u=a.get(f);else for(let n=0;n<i.length;n++){const{urls:e,fn:t}=i[n];for(let n=0;n<e.length;n++){const r=[],i=("*"===e[n]?/^\/.*(?:\/)?$/i:d(e[n],r)).exec(f);if(i&&i.length>0){const[n,...o]=i,s=r.reduce((n,e,t)=>(n[e.name]=o[t],n),{}),c=[...e,f].filter(n=>!n.includes(":"));await t({urls:c,url:f,params:s}),a.has(f)&&(u=a.get(f));break}}if(u)break}if(u)if(h.nextLocation=s.createHref(e),o.length>0)for(let e=0;e<o.length;e++){const{fromURLs:i,toURLs:a,backAndForth:s,fn:l}=o[e],h=i.includes("*")||i.includes(t),d=s&&i.includes(f),p=a.includes("*")||a.includes(f),v=s&&a.includes(t);if(h&&p||d&&v){const n=await l();await n.play(c,u,r),c=u}else await n.play(c,u,r),c=u}else await n.play(c,u,r),c=u;else console.error("Router :: View not found",a)}catch(n){console.error(n)}}window.history.scrollRestoration=t;const h={nextLocation:null,clickIgnoreClass:"no-router",match:function(n,e){Array.isArray(n)||(n=[n]),i.push({urls:n,fn:e})},transition:function(n,e,t,r=!0){n=Array.isArray(n)?n:[n],e=Array.isArray(e)?e:[e],o.push({fromURLs:n,toURLs:e,fn:t,backAndForth:r})},view:function(n,e){const t=e();Array.isArray(n)||(n=[n]);for(let e=0;e<n.length;e++){let r=w(n[e]);a.set(r,t)}},listen:function({clickEvents:n=!1,clickIgnoreClass:e="no-router"}={}){h.clickIgnoreClass=e,u=p(window.location.href),s.listen(n=>{u=p(window.location.href),l(n,u)}),l(s.location,u),n&&document.addEventListener("click",n=>{let e=n.target;for(;e&&!g(e);)e=e.parentNode;if(e&&function(n,e){const t=g(e),r=n.which>1||n.metaKey||n.ctrlKey||n.shiftKey||n.altKey,i=e.target&&"_blank"===e.target,o=window.location.protocol!==e.protocol||window.location.hostname!==e.hostname,a="string"===e.getAttribute("download"),s=t&&t.includes("mailto:");return!(r||i||o||a||s)}(n,e)&&!e.classList.contains(h.clickIgnoreClass)){n.preventDefault(),n.stopPropagation();const t=p(g(e));h.goTo(t)}})},goTo:function(n){const t=p(n);t!==window.location.pathname&&s.push(v(t,e))},history:s};return h},Object.defineProperty(n,"__esModule",{value:!0})}));
