!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).LemonadeRouter=t()}(this,(function(){"use strict";function e(e,n){void 0===n&&(n={});for(var r=function(e){for(var t=[],n=0;n<e.length;){var r=e[n];if("*"!==r&&"+"!==r&&"?"!==r)if("\\"!==r)if("{"!==r)if("}"!==r)if(":"!==r)if("("!==r)t.push({type:"CHAR",index:n,value:e[n++]});else{var i=1,o="";if("?"===e[s=n+1])throw new TypeError('Pattern cannot start with "?" at '+s);for(;s<e.length;)if("\\"!==e[s]){if(")"===e[s]){if(0===--i){s++;break}}else if("("===e[s]&&(i++,"?"!==e[s+1]))throw new TypeError("Capturing groups are not allowed at "+s);o+=e[s++]}else o+=e[s++]+e[s++];if(i)throw new TypeError("Unbalanced pattern at "+n);if(!o)throw new TypeError("Missing pattern at "+n);t.push({type:"PATTERN",index:n,value:o}),n=s}else{for(var a="",s=n+1;s<e.length;){var f=e.charCodeAt(s);if(!(f>=48&&f<=57||f>=65&&f<=90||f>=97&&f<=122||95===f))break;a+=e[s++]}if(!a)throw new TypeError("Missing parameter name at "+n);t.push({type:"NAME",index:n,value:a}),n=s}else t.push({type:"CLOSE",index:n,value:e[n++]});else t.push({type:"OPEN",index:n,value:e[n++]});else t.push({type:"ESCAPED_CHAR",index:n++,value:e[n++]});else t.push({type:"MODIFIER",index:n,value:e[n++]})}return t.push({type:"END",index:n,value:""}),t}(e),i=n.prefixes,o=void 0===i?"./":i,a="[^"+t(n.delimiter||"/#?")+"]+?",s=[],f=0,l=0,u="",c=function(e){if(l<r.length&&r[l].type===e)return r[l++].value},p=function(e){var t=c(e);if(void 0!==t)return t;var n=r[l],i=n.type,o=n.index;throw new TypeError("Unexpected "+i+" at "+o+", expected "+e)},d=function(){for(var e,t="";e=c("CHAR")||c("ESCAPED_CHAR");)t+=e;return t};l<r.length;){var h=c("CHAR"),v=c("NAME"),w=c("PATTERN");if(v||w){var y=h||"";-1===o.indexOf(y)&&(u+=y,y=""),u&&(s.push(u),u=""),s.push({name:v||f++,prefix:y,suffix:"",pattern:w||a,modifier:c("MODIFIER")||""})}else{var g=h||c("ESCAPED_CHAR");if(g)u+=g;else if(u&&(s.push(u),u=""),c("OPEN")){y=d();var m=c("NAME")||"",E=c("PATTERN")||"",x=d();p("CLOSE"),s.push({name:m||(E?f++:""),pattern:m&&!E?a:E,prefix:y,suffix:x,modifier:c("MODIFIER")||""})}else p("END")}}return s}function t(e){return e.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1")}function n(e){return e&&e.sensitive?"":"i"}function r(r,i,o){return function(e,r,i){void 0===i&&(i={});for(var o=i.strict,a=void 0!==o&&o,s=i.start,f=void 0===s||s,l=i.end,u=void 0===l||l,c=i.encode,p=void 0===c?function(e){return e}:c,d="["+t(i.endsWith||"")+"]|$",h="["+t(i.delimiter||"/#?")+"]",v=f?"^":"",w=0,y=e;w<y.length;w++){var g=y[w];if("string"==typeof g)v+=t(p(g));else{var m=t(p(g.prefix)),E=t(p(g.suffix));if(g.pattern)if(r&&r.push(g),m||E)if("+"===g.modifier||"*"===g.modifier){var x="*"===g.modifier?"?":"";v+="(?:"+m+"((?:"+g.pattern+")(?:"+E+m+"(?:"+g.pattern+"))*)"+E+")"+x}else v+="(?:"+m+"("+g.pattern+")"+E+")"+g.modifier;else v+="("+g.pattern+")"+g.modifier;else v+="(?:"+m+E+")"+g.modifier}}if(u)a||(v+=h+"?"),v+=i.endsWith?"(?="+d+")":"$";else{var A=e[e.length-1],R="string"==typeof A?h.indexOf(A[A.length-1])>-1:void 0===A;a||(v+="(?:"+h+"(?="+d+"))?"),R||(v+="(?="+h+"|"+d+")")}return new RegExp(v,n(i))}(e(r,o),i,o)}function i(e,t,o){return e instanceof RegExp?function(e,t){if(!t)return e;var n=e.source.match(/\((?!\?)/g);if(n)for(var r=0;r<n.length;r++)t.push({name:r,prefix:"",suffix:"",modifier:"",pattern:""});return e}(e,t):Array.isArray(e)?function(e,t,r){var o=e.map((function(e){return i(e,t,r).source}));return new RegExp("(?:"+o.join("|")+")",n(r))}(e,t,o):r(e,t,o)}const o=e=>a(e).path,a=e=>({path:e.replace(window.location.origin,"")}),s=(e,t)=>((e,t)=>new RegExp("^"+t+"(\\/|\\?|#|$)","i").test(e))(e,t)?e:t+e;function f(e){if(e){const t=e.getAttribute&&e.getAttribute("xlink:href");if("string"==typeof t)return t;if(e.href)return e.href}return!1}return function({defaultTransition:e={play:function(e,t){e&&e.leave(t),t.enter(e)}},basename:t="",scrollRestoration:n="auto",transitionParams:r={}}={}){const a=[],l=[],u=new Map;let c=createBrowserHistory(),p=null,d=null,h=null,v=null;async function w(n,o){try{const f=s(n.pathname,t);let c;if(u.has(f))c=u.get(f);else for(let e=0;e<a.length;e++){const{urls:t,fn:n}=a[e];for(let e=0;e<t.length;e++){const r=[],o=("*"===t[e]?/^\/.*(?:\/)?$/i:i(t[e],r)).exec(f);if(o&&o.length>0){const[e,...i]=o,a=r.reduce((e,t,n)=>(e[t.name]=i[n],e),{}),s=[...t,f].filter(e=>!e.includes(":"));await n({urls:s,url:f,params:a}),u.has(f)&&(c=u.get(f));break}}if(c)break}if(c)if(d=f,l.length>0)for(let t=0;t<l.length;t++){const{fromURLs:n,toURLs:i,backAndForth:a,fn:s}=l[t],u=n.includes("*")||n.includes(o),d=a&&n.includes(f),h=i.includes("*")||i.includes(f),v=a&&i.includes(o);if(u&&h||d&&v){const e=await s();await e.play(p,c,r),p=c}else await e.play(p,c,r),p=c}else await e.play(p,c,r),p=c;else console.error("Router :: View not found",u)}catch(e){console.error(e)}}return window.history.scrollRestoration=n,{match:function(e,n){Array.isArray(e)||(e=[e]),e=e.map(e=>s(e,t)),a.push({urls:e,fn:n})},transition:function(e,t,n,r=!0){e=Array.isArray(e)?e:[e],t=Array.isArray(t)?t:[t],l.push({fromURLs:e,toURLs:t,fn:n,backAndForth:r})},view:function(e,n){const r=n();Array.isArray(e)||(e=[e]),e.forEach(e=>{const n=s(e,t);u.set(n,r)})},listen:function({clickEvents:e=!1,clickIgnoreClass:t="no-router"}={}){v=t,h=o(window.location.href),c.listen(e=>{h=o(window.location.href),w(e,h)}),w(window.location,h),e&&document.addEventListener("click",e=>{let t=e.target;for(;t&&!f(t);)t=t.parentNode;if(t&&function(e,t){const n=f(t),r=e.which>1||e.metaKey||e.ctrlKey||e.shiftKey||e.altKey,i=t.target&&"_blank"===t.target,o=window.location.protocol!==t.protocol||window.location.hostname!==t.hostname,a="string"===t.getAttribute("download"),s=n&&n.includes("mailto:");return!(r||i||o||a||s)}(e,t)&&!t.classList.contains(v)){e.preventDefault(),e.stopPropagation();const n=f(t),r=o(n);router.goTo(r)}})},goTo:function(e){let n=o(e);n!==window.location.pathname&&c.push(s(n,t))},nextLocation:()=>d}}}));
