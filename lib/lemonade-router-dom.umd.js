!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).LemonadeRouterDOM=t()}(this,(function(){"use strict";function e(e,n){void 0===n&&(n={});for(var r=function(e){for(var t=[],n=0;n<e.length;){var r=e[n];if("*"!==r&&"+"!==r&&"?"!==r)if("\\"!==r)if("{"!==r)if("}"!==r)if(":"!==r)if("("!==r)t.push({type:"CHAR",index:n,value:e[n++]});else{var i=1,o="";if("?"===e[s=n+1])throw new TypeError('Pattern cannot start with "?" at '+s);for(;s<e.length;)if("\\"!==e[s]){if(")"===e[s]){if(0===--i){s++;break}}else if("("===e[s]&&(i++,"?"!==e[s+1]))throw new TypeError("Capturing groups are not allowed at "+s);o+=e[s++]}else o+=e[s++]+e[s++];if(i)throw new TypeError("Unbalanced pattern at "+n);if(!o)throw new TypeError("Missing pattern at "+n);t.push({type:"PATTERN",index:n,value:o}),n=s}else{for(var a="",s=n+1;s<e.length;){var l=e.charCodeAt(s);if(!(l>=48&&l<=57||l>=65&&l<=90||l>=97&&l<=122||95===l))break;a+=e[s++]}if(!a)throw new TypeError("Missing parameter name at "+n);t.push({type:"NAME",index:n,value:a}),n=s}else t.push({type:"CLOSE",index:n,value:e[n++]});else t.push({type:"OPEN",index:n,value:e[n++]});else t.push({type:"ESCAPED_CHAR",index:n++,value:e[n++]});else t.push({type:"MODIFIER",index:n,value:e[n++]})}return t.push({type:"END",index:n,value:""}),t}(e),i=n.prefixes,o=void 0===i?"./":i,a="[^"+t(n.delimiter||"/#?")+"]+?",s=[],l=0,f=0,c="",u=function(e){if(f<r.length&&r[f].type===e)return r[f++].value},p=function(e){var t=u(e);if(void 0!==t)return t;var n=r[f],i=n.type,o=n.index;throw new TypeError("Unexpected "+i+" at "+o+", expected "+e)},d=function(){for(var e,t="";e=u("CHAR")||u("ESCAPED_CHAR");)t+=e;return t};f<r.length;){var h=u("CHAR"),w=u("NAME"),m=u("PATTERN");if(w||m){var v=h||"";-1===o.indexOf(v)&&(c+=v,v=""),c&&(s.push(c),c=""),s.push({name:w||l++,prefix:v,suffix:"",pattern:m||a,modifier:u("MODIFIER")||""})}else{var y=h||u("ESCAPED_CHAR");if(y)c+=y;else if(c&&(s.push(c),c=""),u("OPEN")){v=d();var g=u("NAME")||"",E=u("PATTERN")||"",x=d();p("CLOSE"),s.push({name:g||(E?l++:""),pattern:g&&!E?a:E,prefix:v,suffix:x,modifier:u("MODIFIER")||""})}else p("END")}}return s}function t(e){return e.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1")}function n(e){return e&&e.sensitive?"":"i"}function r(r,i,o){return function(e,r,i){void 0===i&&(i={});for(var o=i.strict,a=void 0!==o&&o,s=i.start,l=void 0===s||s,f=i.end,c=void 0===f||f,u=i.encode,p=void 0===u?function(e){return e}:u,d="["+t(i.endsWith||"")+"]|$",h="["+t(i.delimiter||"/#?")+"]",w=l?"^":"",m=0,v=e;m<v.length;m++){var y=v[m];if("string"==typeof y)w+=t(p(y));else{var g=t(p(y.prefix)),E=t(p(y.suffix));if(y.pattern)if(r&&r.push(y),g||E)if("+"===y.modifier||"*"===y.modifier){var x="*"===y.modifier?"?":"";w+="(?:"+g+"((?:"+y.pattern+")(?:"+E+g+"(?:"+y.pattern+"))*)"+E+")"+x}else w+="(?:"+g+"("+y.pattern+")"+E+")"+y.modifier;else w+="("+y.pattern+")"+y.modifier;else w+="(?:"+g+E+")"+y.modifier}}if(c)a||(w+=h+"?"),w+=i.endsWith?"(?="+d+")":"$";else{var A=e[e.length-1],R="string"==typeof A?h.indexOf(A[A.length-1])>-1:void 0===A;a||(w+="(?:"+h+"(?="+d+"))?"),R||(w+="(?="+h+"|"+d+")")}return new RegExp(w,n(i))}(e(r,o),i,o)}function i(e,t,o){return e instanceof RegExp?function(e,t){if(!t)return e;var n=e.source.match(/\((?!\?)/g);if(n)for(var r=0;r<n.length;r++)t.push({name:r,prefix:"",suffix:"",modifier:"",pattern:""});return e}(e,t):Array.isArray(e)?function(e,t,r){var o=e.map((function(e){return i(e,t,r).source}));return new RegExp("(?:"+o.join("|")+")",n(r))}(e,t,o):r(e,t,o)}const o=e=>a(e).path,a=e=>({path:e.replace(window.location.origin,"")}),s=(e,t)=>((e,t)=>new RegExp("^"+t+"(\\/|\\?|#|$)","i").test(e))(e,t)?e:t+e;function l(e){if(e){const t=e.getAttribute&&e.getAttribute("xlink:href");if("string"==typeof t)return t;if(e.href)return e.href}return!1}function f({defaultTransition:e={play:function(e,t){e&&e.leave(t),t.enter(e)}},basename:t="",scrollRestoration:n="auto",transitionParams:r={}}={}){const a=[],f=[],c=new Map;let u=createBrowserHistory(),p=null,d=null,h=null,w=null;async function m(n,o){try{const l=s(n.pathname,t);let u;if(c.has(l))u=c.get(l);else for(let e=0;e<a.length;e++){const{urls:t,fn:n}=a[e];for(let e=0;e<t.length;e++){const r=[],o=("*"===t[e]?/^\/.*(?:\/)?$/i:i(t[e],r)).exec(l);if(o&&o.length>0){const[e,...i]=o,a=r.reduce((e,t,n)=>(e[t.name]=i[n],e),{}),s=[...t,l].filter(e=>!e.includes(":"));await n({urls:s,url:l,params:a}),c.has(l)&&(u=c.get(l));break}}if(u)break}if(u)if(d=l,f.length>0)for(let t=0;t<f.length;t++){const{fromURLs:n,toURLs:i,backAndForth:a,fn:s}=f[t],c=n.includes("*")||n.includes(o),d=a&&n.includes(l),h=i.includes("*")||i.includes(l),w=a&&i.includes(o);if(c&&h||d&&w){const e=await s();await e.play(p,u,r),p=u}else await e.play(p,u,r),p=u}else await e.play(p,u,r),p=u;else console.error("Router :: View not found",c)}catch(e){console.error(e)}}return window.history.scrollRestoration=n,{match:function(e,n){Array.isArray(e)||(e=[e]),e=e.map(e=>s(e,t)),a.push({urls:e,fn:n})},transition:function(e,t,n,r=!0){e=Array.isArray(e)?e:[e],t=Array.isArray(t)?t:[t],f.push({fromURLs:e,toURLs:t,fn:n,backAndForth:r})},view:function(e,n){const r=n();Array.isArray(e)||(e=[e]),e.forEach(e=>{const n=s(e,t);c.set(n,r)})},listen:function({clickEvents:e=!1,clickIgnoreClass:t="no-router"}={}){w=t,h=o(window.location.href),u.listen(e=>{h=o(window.location.href),m(e,h)}),m(window.location,h),e&&document.addEventListener("click",e=>{let t=e.target;for(;t&&!l(t);)t=t.parentNode;if(t&&function(e,t){const n=l(t),r=e.which>1||e.metaKey||e.ctrlKey||e.shiftKey||e.altKey,i=t.target&&"_blank"===t.target,o=window.location.protocol!==t.protocol||window.location.hostname!==t.hostname,a="string"===t.getAttribute("download"),s=n&&n.includes("mailto:");return!(r||i||o||a||s)}(e,t)&&!t.classList.contains(w)){e.preventDefault(),e.stopPropagation();const n=l(t),r=o(n);router.goTo(r)}})},goTo:function(e){let n=o(e);n!==window.location.pathname&&u.push(s(n,t))},nextLocation:()=>d}}function c({wrapperClass:e=".lemonade-wrapper",containerClass:t=".lemonade-container",ignoreClass:n="no-router",cacheEnabled:r=!0,defaultTransition:i={play:async function(e,t,{loadView:n,appendView:r,removeView:i}){e&&(await e.leave(t),await n(),r(),i()),await t.enter(e)}},transitionParams:a={},basename:s=""}={}){let l,u,p,d=f({defaultTransition:i,basename:s,ignoreClass:n,transitionParams:{...a,loadView:async function(){let e,n=d.nextLocation();if(r&&h.get(n))e=h.get(n);else{const t=await c.fetch(n);e=t.result,r&&h.set(n,e)}const i=document.createElement("div");i.innerHTML=e;const o=i.querySelector("title");o&&(document.title=o.textContent);return u=l.querySelector(t),p=i.querySelector(t),p},appendView:function(){l.appendChild(p)},removeView:function(){u.parentNode.removeChild(u)}}}),h=new Map;return{listen:function({clickEvents:n=!1,clickIgnoreClass:i="no-router"}={}){l=document.querySelector(e),u=l.querySelector(t),d.listen({clickEvents:n,clickIgnoreClass:i}),r&&h.set(o(window.location.href),document.documentElement.innerHTML)},match:d.match,view:d.view,transition:d.transition,goTo:d.goTo}}return c.fetch=async e=>{let t=await fetch(e);return await t.text()},c}));
