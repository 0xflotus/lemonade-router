!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n((e=e||self).Lemonade={})}(this,(function(e){"use strict";function n(){return(n=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e}).apply(this,arguments)}function t(e){return"/"===e.charAt(0)}function r(e,n){for(var t=n,r=t+1,i=e.length;r<i;t+=1,r+=1)e[t]=e[r];e.pop()}function i(e,i,o,a){var s;"string"==typeof e?(s=function(e){var n=e||"/",t="",r="",i=n.indexOf("#");-1!==i&&(r=n.substr(i),n=n.substr(0,i));var o=n.indexOf("?");return-1!==o&&(t=n.substr(o),n=n.substr(0,o)),{pathname:n,search:"?"===t?"":t,hash:"#"===r?"":r}}(e)).state=i:(void 0===(s=n({},e)).pathname&&(s.pathname=""),s.search?"?"!==s.search.charAt(0)&&(s.search="?"+s.search):s.search="",s.hash?"#"!==s.hash.charAt(0)&&(s.hash="#"+s.hash):s.hash="",void 0!==i&&void 0===s.state&&(s.state=i));try{s.pathname=decodeURI(s.pathname)}catch(e){throw e instanceof URIError?new URIError('Pathname "'+s.pathname+'" could not be decoded. This is likely caused by an invalid percent-encoding.'):e}return o&&(s.key=o),a?s.pathname?"/"!==s.pathname.charAt(0)&&(s.pathname=function(e,n){void 0===n&&(n="");var i,o=e&&e.split("/")||[],a=n&&n.split("/")||[],s=e&&t(e),c=n&&t(n),f=s||c;if(e&&t(e)?a=o:o.length&&(a.pop(),a=a.concat(o)),!a.length)return"/";if(a.length){var u=a[a.length-1];i="."===u||".."===u||""===u}else i=!1;for(var l=0,h=a.length;h>=0;h--){var d=a[h];"."===d?r(a,h):".."===d?(r(a,h),l++):l&&(r(a,h),l--)}if(!f)for(;l--;l)a.unshift("..");!f||""===a[0]||a[0]&&t(a[0])||a.unshift("");var p=a.join("/");return i&&"/"!==p.substr(-1)&&(p+="/"),p}(s.pathname,a.pathname)):s.pathname=a.pathname:s.pathname||(s.pathname="/"),s}var o=!("undefined"==typeof window||!window.document||!window.document.createElement);function a(e,n){n(window.confirm(e))}function s(){try{return window.history.state||{}}catch(e){return{}}}function c(e){void 0===e&&(e={}),o||function(e,n){if(!e)throw new Error("Invariant failed")}(!1);var t,r,c=window.history,f=(-1===(t=window.navigator.userAgent).indexOf("Android 2.")&&-1===t.indexOf("Android 4.0")||-1===t.indexOf("Mobile Safari")||-1!==t.indexOf("Chrome")||-1!==t.indexOf("Windows Phone"))&&window.history&&"pushState"in window.history,u=!(-1===window.navigator.userAgent.indexOf("Trident")),l=e,h=l.forceRefresh,d=void 0!==h&&h,p=l.getUserConfirmation,v=void 0===p?a:p,w=l.keyLength,m=void 0===w?6:w,y=e.basename?function(e){return"/"===e.charAt(e.length-1)?e.slice(0,-1):e}("/"===(r=e.basename).charAt(0)?r:"/"+r):"";function g(e){var n=e||{},t=n.key,r=n.state,o=window.location,a=o.pathname+o.search+o.hash;return y&&(a=function(e,n){return function(e,n){return 0===e.toLowerCase().indexOf(n.toLowerCase())&&-1!=="/?#".indexOf(e.charAt(n.length))}(e,n)?e.substr(n.length):e}(a,y)),i(a,r,t)}function x(){return Math.random().toString(36).substr(2,m)}var E,A,b=(E=null,A=[],{setPrompt:function(e){return E=e,function(){E===e&&(E=null)}},confirmTransitionTo:function(e,n,t,r){if(null!=E){var i="function"==typeof E?E(e,n):E;"string"==typeof i?"function"==typeof t?t(i,r):r(!0):r(!1!==i)}else r(!0)},appendListener:function(e){var n=!0;function t(){n&&e.apply(void 0,arguments)}return A.push(t),function(){n=!1,A=A.filter((function(e){return e!==t}))}},notifyListeners:function(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];A.forEach((function(e){return e.apply(void 0,n)}))}});function O(e){n(N,e),N.length=c.length,b.notifyListeners(N.location,N.action)}function k(e){(function(e){return void 0===e.state&&-1===navigator.userAgent.indexOf("CriOS")})(e)||R(g(e.state))}function C(){R(g(s()))}var T=!1;function R(e){if(T)T=!1,O();else{b.confirmTransitionTo(e,"POP",v,(function(n){n?O({action:"POP",location:e}):function(e){var n=N.location,t=L.indexOf(n.key);-1===t&&(t=0);var r=L.indexOf(e.key);-1===r&&(r=0);var i=t-r;i&&(T=!0,M(i))}(e)}))}}var P=g(s()),L=[P.key];function S(e){return y+function(e){var n=e.pathname,t=e.search,r=e.hash,i=n||"/";return t&&"?"!==t&&(i+="?"===t.charAt(0)?t:"?"+t),r&&"#"!==r&&(i+="#"===r.charAt(0)?r:"#"+r),i}(e)}function M(e){c.go(e)}var I=0;function H(e){1===(I+=e)&&1===e?(window.addEventListener("popstate",k),u&&window.addEventListener("hashchange",C)):0===I&&(window.removeEventListener("popstate",k),u&&window.removeEventListener("hashchange",C))}var U=!1;var N={length:c.length,action:"POP",location:P,createHref:S,push:function(e,n){var t=i(e,n,x(),N.location);b.confirmTransitionTo(t,"PUSH",v,(function(e){if(e){var n=S(t),r=t.key,i=t.state;if(f)if(c.pushState({key:r,state:i},null,n),d)window.location.href=n;else{var o=L.indexOf(N.location.key),a=L.slice(0,o+1);a.push(t.key),L=a,O({action:"PUSH",location:t})}else window.location.href=n}}))},replace:function(e,n){var t=i(e,n,x(),N.location);b.confirmTransitionTo(t,"REPLACE",v,(function(e){if(e){var n=S(t),r=t.key,i=t.state;if(f)if(c.replaceState({key:r,state:i},null,n),d)window.location.replace(n);else{var o=L.indexOf(N.location.key);-1!==o&&(L[o]=t.key),O({action:"REPLACE",location:t})}else window.location.replace(n)}}))},go:M,goBack:function(){M(-1)},goForward:function(){M(1)},block:function(e){void 0===e&&(e=!1);var n=b.setPrompt(e);return U||(H(1),U=!0),function(){return U&&(U=!1,H(-1)),n()}},listen:function(e){var n=b.appendListener(e);return H(1),function(){H(-1),n()}}};return N}function f(e,n){void 0===n&&(n={});for(var t=function(e){for(var n=[],t=0;t<e.length;){var r=e[t];if("*"!==r&&"+"!==r&&"?"!==r)if("\\"!==r)if("{"!==r)if("}"!==r)if(":"!==r)if("("!==r)n.push({type:"CHAR",index:t,value:e[t++]});else{var i=1,o="";if("?"===e[s=t+1])throw new TypeError('Pattern cannot start with "?" at '+s);for(;s<e.length;)if("\\"!==e[s]){if(")"===e[s]){if(0===--i){s++;break}}else if("("===e[s]&&(i++,"?"!==e[s+1]))throw new TypeError("Capturing groups are not allowed at "+s);o+=e[s++]}else o+=e[s++]+e[s++];if(i)throw new TypeError("Unbalanced pattern at "+t);if(!o)throw new TypeError("Missing pattern at "+t);n.push({type:"PATTERN",index:t,value:o}),t=s}else{for(var a="",s=t+1;s<e.length;){var c=e.charCodeAt(s);if(!(c>=48&&c<=57||c>=65&&c<=90||c>=97&&c<=122||95===c))break;a+=e[s++]}if(!a)throw new TypeError("Missing parameter name at "+t);n.push({type:"NAME",index:t,value:a}),t=s}else n.push({type:"CLOSE",index:t,value:e[t++]});else n.push({type:"OPEN",index:t,value:e[t++]});else n.push({type:"ESCAPED_CHAR",index:t++,value:e[t++]});else n.push({type:"MODIFIER",index:t,value:e[t++]})}return n.push({type:"END",index:t,value:""}),n}(e),r=n.prefixes,i=void 0===r?"./":r,o="[^"+u(n.delimiter||"/#?")+"]+?",a=[],s=0,c=0,f="",l=function(e){if(c<t.length&&t[c].type===e)return t[c++].value},h=function(e){var n=l(e);if(void 0!==n)return n;var r=t[c],i=r.type,o=r.index;throw new TypeError("Unexpected "+i+" at "+o+", expected "+e)},d=function(){for(var e,n="";e=l("CHAR")||l("ESCAPED_CHAR");)n+=e;return n};c<t.length;){var p=l("CHAR"),v=l("NAME"),w=l("PATTERN");if(v||w){var m=p||"";-1===i.indexOf(m)&&(f+=m,m=""),f&&(a.push(f),f=""),a.push({name:v||s++,prefix:m,suffix:"",pattern:w||o,modifier:l("MODIFIER")||""})}else{var y=p||l("ESCAPED_CHAR");if(y)f+=y;else if(f&&(a.push(f),f=""),l("OPEN")){m=d();var g=l("NAME")||"",x=l("PATTERN")||"",E=d();h("CLOSE"),a.push({name:g||(x?s++:""),pattern:g&&!x?o:x,prefix:m,suffix:E,modifier:l("MODIFIER")||""})}else h("END")}}return a}function u(e){return e.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1")}function l(e){return e&&e.sensitive?"":"i"}function h(e,n,t){return function(e,n,t){void 0===t&&(t={});for(var r=t.strict,i=void 0!==r&&r,o=t.start,a=void 0===o||o,s=t.end,c=void 0===s||s,f=t.encode,h=void 0===f?function(e){return e}:f,d="["+u(t.endsWith||"")+"]|$",p="["+u(t.delimiter||"/#?")+"]",v=a?"^":"",w=0,m=e;w<m.length;w++){var y=m[w];if("string"==typeof y)v+=u(h(y));else{var g=u(h(y.prefix)),x=u(h(y.suffix));if(y.pattern)if(n&&n.push(y),g||x)if("+"===y.modifier||"*"===y.modifier){var E="*"===y.modifier?"?":"";v+="(?:"+g+"((?:"+y.pattern+")(?:"+x+g+"(?:"+y.pattern+"))*)"+x+")"+E}else v+="(?:"+g+"("+y.pattern+")"+x+")"+y.modifier;else v+="("+y.pattern+")"+y.modifier;else v+="(?:"+g+x+")"+y.modifier}}if(c)i||(v+=p+"?"),v+=t.endsWith?"(?="+d+")":"$";else{var A=e[e.length-1],b="string"==typeof A?p.indexOf(A[A.length-1])>-1:void 0===A;i||(v+="(?:"+p+"(?="+d+"))?"),b||(v+="(?="+p+"|"+d+")")}return new RegExp(v,l(t))}(f(e,t),n,t)}function d(e,n,t){return e instanceof RegExp?function(e,n){if(!n)return e;var t=e.source.match(/\((?!\?)/g);if(t)for(var r=0;r<t.length;r++)n.push({name:r,prefix:"",suffix:"",modifier:"",pattern:""});return e}(e,n):Array.isArray(e)?function(e,n,t){var r=e.map((function(e){return d(e,n,t).source}));return new RegExp("(?:"+r.join("|")+")",l(t))}(e,n,t):h(e,n,t)}function p(e){return function(e){return{path:e.replace(window.location.origin,"")}}(e).path}function v(e,n){return function(e,n){return new RegExp("^"+n+"(\\/|\\?|#|$)","i").test(e)}(e,n)?e.substr(n.length):e}function w(e){if(e){const n=e.getAttribute&&e.getAttribute("xlink:href");if("string"==typeof n)return n;if(e.href)return e.href}return!1}function m({defaultTransition:e={play:function(e,n){e&&e.leave(n),n.enter(e)}},basename:n="",scrollRestoration:t="auto",transitionParams:r={}}={}){const i=[],o=[],a=new Map;let s=c({basename:n}),f=null,u=null,l=null;async function h(n,t){try{const c=n.pathname;let u;if(a.has(c))u=a.get(c);else for(let e=0;e<i.length;e++){const{urls:n,fn:t}=i[e];for(let e=0;e<n.length;e++){const r=[],i=("*"===n[e]?/^\/.*(?:\/)?$/i:d(n[e],r)).exec(c);if(i&&i.length>0){const[e,...o]=i,s=r.reduce((e,n,t)=>(e[n.name]=o[t],e),{}),f=[...n,c].filter(e=>!e.includes(":"));await t({urls:f,url:c,params:s}),a.has(c)&&(u=a.get(c));break}}if(u)break}if(u)if(m.nextLocation=s.createHref(n),o.length>0)for(let n=0;n<o.length;n++){const{fromURLs:i,toURLs:a,backAndForth:s,fn:l}=o[n],h=i.includes("*")||i.includes(t),d=s&&i.includes(c),p=a.includes("*")||a.includes(c),v=s&&a.includes(t);if(h&&p||d&&v){const e=await l();await e.play(f,u,r),f=u}else await e.play(f,u,r),f=u}else await e.play(f,u,r),f=u;else console.error("Router :: View not found",a)}catch(e){console.error(e)}}window.history.scrollRestoration=t;const m={nextLocation:null,match:function(e,n){Array.isArray(e)||(e=[e]),i.push({urls:e,fn:n})},transition:function(e,n,t,r=!0){e=Array.isArray(e)?e:[e],n=Array.isArray(n)?n:[n],o.push({fromURLs:e,toURLs:n,fn:t,backAndForth:r})},view:function(e,n){const t=n();Array.isArray(e)||(e=[e]);for(let n=0;n<e.length;n++)a.set(e[n],t)},listen:function({clickEvents:e=!1,clickIgnoreClass:n="no-router"}={}){l=n,u=p(window.location.href),s.listen(e=>{u=p(window.location.href),h(e,u)}),h(s.location,u),e&&document.addEventListener("click",e=>{let n=e.target;for(;n&&!w(n);)n=n.parentNode;if(n&&function(e,n){const t=w(n),r=e.which>1||e.metaKey||e.ctrlKey||e.shiftKey||e.altKey,i=n.target&&"_blank"===n.target,o=window.location.protocol!==n.protocol||window.location.hostname!==n.hostname,a="string"===n.getAttribute("download"),s=t&&t.includes("mailto:");return!(r||i||o||a||s)}(e,n)&&!n.classList.contains(l)){e.preventDefault(),e.stopPropagation();const t=p(w(n));m.goTo(t)}})},goTo:function(e){let t=p(e);if(t===window.location.pathname)return;const r={pathname:v(t,n),search:window.location.search,hash:window.location.hash};s.push(r)},history:s};return m}function y({wrapperClass:e=".lemonade-wrapper",containerClass:n=".lemonade-container",ignoreClass:t="no-router",cacheEnabled:r=!0,defaultTransition:i={play:async function(e,n,{loadView:t,appendView:r,removeView:i}){e&&(await e.leave(n),await t(),r(),i()),await n.enter(e)}},transitionParams:o={},basename:a=""}={}){let s,c,f,u=m({defaultTransition:i,basename:a,ignoreClass:t,transitionParams:{...o,loadView:async function(){let e,{nextLocation:t}=u;r&&l.get(t)?e=l.get(t):(e=await y.fetch(t),r&&l.set(t,e));const i=document.createElement("html");i.innerHTML=e;const o=i.querySelector("title");o&&(document.title=o.textContent);return c=s.querySelector(n),f=i.querySelector(n),{prevContainer:c,nextContainer:f,temp:i}},appendView:function(){s.appendChild(f)},removeView:function(){s.removeChild(c)}}}),l=new Map;return{listen:function({clickEvents:t=!1,clickIgnoreClass:i="no-router"}={}){s=document.querySelector(e),c=s.querySelector(n),u.listen({clickEvents:t,clickIgnoreClass:i}),r&&!l.has(window.location.pathname)&&l.set(window.location.pathname,document.documentElement.innerHTML)},match:u.match,view:u.view,transition:u.transition,goTo:u.goTo,cache:l}}y.fetch=async e=>{let n=await fetch(e);return await n.text()},e.RouterDOM=y,Object.defineProperty(e,"__esModule",{value:!0})}));
